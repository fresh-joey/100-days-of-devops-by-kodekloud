# Day 20: Configure Nginx + PHP-FPM Using Unix Sock

## Requirements
The Nautilus application development team is planning to launch a new PHP-based application, which they want to deploy on Nautilus infra in Stratos DC. The development team had a meeting with the production support team and they have shared some requirements regarding the infrastructure. Below are the requirements they shared:

a. Install nginx on app server 2 , configure it to use port 8098 and its document root should be /var/www/html.

b. Install php-fpm version 8.2 on app server 2, it must use the unix socket /var/run/php-fpm/default.sock (create the parent directories if don't exist).

c. Configure php-fpm and nginx to work together.

d. Once configured correctly, you can test the website using curl http://stapp02:8098/index.php command from jump host.

## Steps
- SSH into App server 2
- Install Nginx
- Enable php 8.2 repository
  ```console
  sudo dnf module reset php -y
  sudo dnf module enable php:8.2 -y
  ```
- Install php-fpm 
  ```console
  sudo dnf install -y php php-fpm php-cli php-common php-mysqlnd php-gd php-mbstring php-xml php-opcache
  ```
- Create the socket directory
  ```console
  sudo mkdir -p /var/run/php-fpm
  ```
- Configure the php-fpm
  ```console
  /etc/php-fpm.d/www.conf
  ```
- Change the `listen` line and `permissions` to look like this
  ```console
  listen = /var/run/php-fpm/default.sock
  listen.owner = nginx
  listen.group = nginx
  listen.mode = 0660
  user = nginx
  group = nginx
  ```
- Start and enable php-fpm
  ```console
  sudo systemctl enable php-fpm
  sudo systemctl start php-fpm
  ```
- Add the content to the nginx conf inside the server block
  ```ini
    index index.php index.html;

    location / {
        try_files $uri $uri/ =404;
    }

    location ~ \.php$ {
        include fastcgi_params;
        fastcgi_pass unix:/var/run/php-fpm/default.sock;
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    }
  ```
- Check the syntax
- Restart nginx
- Test the connection from Jump host
  ```console
  curl http://stapp02:8098/index.php
  ```
- 

## üìù Notes
Ensure the configurations are done carefully

