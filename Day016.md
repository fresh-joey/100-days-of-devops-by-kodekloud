# Day 16: Install and Configure Nginx as an LBR

## Requirements
Day by day traffic is increasing on one of the websites managed by the Nautilus production support team. Therefore, the team has observed a degradation in website performance. Following discussions about this issue, the team has decided to deploy this application on a high availability stack i.e on Nautilus infra in Stratos DC. They started the migration last month and it is almost done, as only the LBR server configuration is pending. Configure LBR server as per the information given below:

a. Install nginx on LBR (load balancer) server.

b. Configure load-balancing with the an http context making use of all App Servers. Ensure that you update only the main Nginx configuration file located at /etc/nginx/nginx.conf.

c. Make sure you do not update the apache port that is already defined in the apache configuration on all app servers, also make sure apache service is up and running on all app servers.

d. Once done, you can access the website using StaticApp button on the top bar.

## Steps
- SSH into the load balancer server
- Install Nginx
- Enable and Start Nginx
- Check the APP server to know the port Apache is running on
  ```console
  sudo netstat -tulnp | grep http
  ```
- Configure Nginx to act as a load balancer. Edit the nginx.conf file. Replace the default server block with the content below. Place it after the server name
  ```ini
    location / {
        proxy_pass http://app_servers;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
  ```
- Put this before the server name block
  ```ini
    upstream app_servers {
      server 172.16.238.10:3001;
      server 172.16.238.11:3001;
      server 172.16.238.12:3001;
    }
  ```
- Verify the configuration
  ```console
  sudo nginx -t
  ```
- Restart the nginx service
- Check the static app link for the content of the server


## üìù Notes
Ensure the Apache port on the server is known and include it inside the Load balancer configuration
Always check the syntax configuration after editing the conf file
